<%= render "shared/header" %>

<div class="container mt-4">
  <h1 class="mb-4"><%= @movie_details["title"] %></h1>
  <div class="row">
    <div class="col-md-4">
      <% if @movie_details["poster_path"].present? %>
        <img src="https://image.tmdb.org/t/p/w300<%= @movie_details['poster_path'] %>" alt="<%= @movie_details['title'] %>">
      <% else %>
        <img src="https://via.placeholder.com/300x450?text=No+Image" alt="No Image">
      <% end %>
    </div>
    <div class="col-md-8">
      <p><strong>概要:</strong> <%= @movie_details["overview"] %></p>
      <p><strong>公開日:</strong> <%= @movie_details["release_date"] %></p>
      <p><strong>評価:</strong> <%= @movie_details["vote_average"] %> / 10</p>
      <p><strong>👀 視聴者数:</strong> <%= @viewer_count %> 人</p>

      <!-- 👀 視聴開始 / 視聴終了 ボタン -->
      <% if Viewing.exists?(user: current_user, movie_id: @movie_details["id"], active: true) %>
        <p>🎥 現在視聴中</p>
        <%= button_to "視聴終了", stop_viewing_movie_path(@movie_details["id"]), method: :post, class: "btn btn-danger" %>
      <% else %>
        <%= button_to "視聴開始", start_viewing_movie_path(@movie_details["id"]), method: :post, class: "btn btn-primary" %>
      <% end %>

      <!-- チャットボタン -->
      <%= link_to "チャットに参加する", movie_chats_path(movie_id: params[:id]), class: "btn btn-primary mt-3" %>
    </div>
  </div>
</div>
