<% per_slide = 5 %> <!-- „Éá„Éï„Ç©„É´„Éà„ÅØPCÁî®„ÅÆ5Êú¨ -->
<% if request.user_agent =~ /Mobile|Android/ %>
  <% per_slide = 3 %> <!-- „Çπ„Éû„Éõ„Å™„Çâ3Êú¨ -->
<% end %>

<div id="<%= carousel_id %>" class="carousel slide">
  <div class="carousel-inner">
    <% movies.each_slice(per_slide).with_index do |movie_batch, index| %>
      <div class="carousel-item <%= 'active' if index == 0 %>">
        <div class="row flex-nowrap align-items-center">
          <% movie_batch.each do |movie| %>
            <div class="movie-card col-md-2 col-4 text-center">
              <%= link_to movie_path(movie["id"]) do %>
                <% if movie["poster_path"].present? %>
                  <img src="https://image.tmdb.org/t/p/w300<%= movie["poster_path"] %>" 
                      alt="<%= movie["title"] %>" class="img-fluid rounded">
                <% else %>
                  <img src="https://via.placeholder.com/300x450?text=No+Image" 
                      alt="No Image" class="img-fluid rounded">
                <% end %>
              <% end %>
              <p class="viewer-count">
                üëÄ <%= Viewing.where(movie_id: movie["id"], active: true).count %> ‰∫∫
                ‚ô° <%= Favorite.where(movie_id: movie["id"]).count %> ‰∫∫
              </p>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- üîÑ „Çπ„É©„Ç§„Éâ„Ç≥„É≥„Éà„É≠„Éº„É´ -->
  <button class="carousel-control-prev" type="button" data-bs-target="#<%= carousel_id %>" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Ââç„Å∏</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#<%= carousel_id %>" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Ê¨°„Å∏</span>
  </button>
</div>
